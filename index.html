<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>정부 정책 AI 크롤링 챗봇</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center">
  <div id="root" class="w-full max-w-2xl p-4"></div>

  <script type="text/babel">
    function App() {
      const [messages, setMessages] = React.useState([]);
      const [input, setInput] = React.useState("");
      const [loading, setLoading] = React.useState(false);

      const handleSend = async () => {
        if (!input.trim()) return;

        const userMessage = { type: "user", text: input };
        setMessages(prev => [...prev, userMessage]);
        setInput("");
        setLoading(true);

        try {
          const res = await fetch("https://tvulocalai-2.onrender.com/crawl", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: input }),
          });

          const data = await res.json();
          const botMessage = { type: "bot", text: data.answer || "결과가 없습니다." };
          setMessages(prev => [...prev, botMessage]);
        } catch (err) {
          setMessages(prev => [...prev, { type: "bot", text: "❌ 서버 응답 오류" }]);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="bg-white shadow-xl rounded-lg p-6 w-full">
          <h1 className="text-2xl font-bold text-center mb-4">정부 정책·지원금 AI 크롤러</h1>
          <div className="space-y-4 mb-4 max-h-96 overflow-y-auto">
            {messages.map((msg, i) => (
              <div key={i} className={`p-3 rounded-lg ${msg.type === "user" ? "bg-blue-100 text-right" : "bg-gray-100 text-left"}`}>
                {msg.text}
              </div>
            ))}
            {loading && <div className="text-gray-500 text-sm">크롤링 중...</div>}
          </div>
          <div className="flex space-x-2">
            <input
              className="flex-1 border border-gray-300 rounded-lg p-3"
              type="text"
              placeholder="예: 청년 지원금 뭐 있어?"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyDown={(e) => e.key === "Enter" && handleSend()}
            />
            <button
              onClick={handleSend}
              className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
            >
              전송
            </button>
          </div>
        </div>
      );
    }

    const root = document.getElementById("root");
    ReactDOM.createRoot(root).render(<App />);
  </script>
</body>
</html>
